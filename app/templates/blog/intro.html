{% load static %}
<!DOCTYPE html>
<html>
<head>
<title>Rambam</title>
  <link rel="stylesheet" href="{% static 'css/intro.css' %}">
   <script type="text/javascript" src="{% static 'js/production_or_local.js' %}"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
</head>
<body style='margin: 0 !important;padding: 0 !important;font-family: muse;' bgcolor="#f8f9fb">

<script src="//vk.com/js/api/openapi.js" type="text/javascript"></script>
<div id="login_button" onclick="VK.Auth.login(authInfo);"></div>
<script language="javascript">
 var fb_api_app_id;
   if (in_production == false){
     
      fb_api_app_id = '394555824254104';
   }

   else{
       
        fb_api_app_id = '394391410937212';

   }

// {% if request.user.userprofile.phone_number = 0 %}
// alert('hello');
// {% endif  %}






 function statusChangeCallback(response) {
    console.log('statusChangeCallback');
    console.log(response);
    // The response object is returned with a status field that lets the
    // app know the current login status of the person.
    // Full docs on the response object can be found in the documentation
    // for FB.getLoginStatus().
    if (response.status === 'connected') {
      // Logged into your app and Facebook.
      // testAPI();
      authFB();
      // alert('connected');

    } else if (response.status === 'not_authorized') {
      // The person is logged into Facebook, but not your app.
      // document.getElementById('status').innerHTML = 'Please log ' +
      //   'into this app.';
          alert('2');
           loginDialogFB()

    } else {
      // The person is not logged into Facebook, so we're not sure if
      // they are logged into this app or not.
      // document.getElementById('status').innerHTML = 'Please log ' +
      //   'into Facebook.';
           // alert('3');
            loginDialogFB()
    }
  }

  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

function loginDialogFB(){

  FB.login(function(response){
   // alert(JSON.stringify(response))
   // alert(response.authResponse.userID)
  authFB();

      // alert(JSON.stringify(response))
},  {scope: 'email'} );
}



  window.fbAsyncInit = function() {
  FB.init({
    // first one is test id
    appId      : fb_api_app_id,
    // appId      : '1174285602624484',
    // appId      : '1136272963092415',
    cookie     : true,  // enable cookies to allow the server to access
                        // the session
    xfbml      : true,  // parse social plugins on this page
    version    : 'v2.8' // use graph api version 2.8
  });

  // Now that we've initialized the JavaScript SDK, we call
  // FB.getLoginStatus().  This function gets the state of the
  // person visiting this page and can return one of three states to
  // the callback you provide.  They can be:
  //
  // 1. Logged into your app ('connected')
  // 2. Logged into Facebook, but not your app ('not_authorized')
  // 3. Not logged into Facebook and can't tell if they are logged into
  //    your app or not.
  //
  // These three cases are handled in the callback function.

  // FB.getLoginStatus(function(response) {
  //   statusChangeCallback(response);
  // });

  FB.getLoginStatus(function(response) {
       if (response.status === 'connected') {
              FB.api('/me?fields=picture.width(30).height(30)', function(response) {
                      var profile_picture_url_FB = response.picture.data.url;
                      $("#profilepicture").attr("src", profile_picture_url_FB);


              });



       }
    });

  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));




  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.
  // function testAPI() {
  //   console.log('Welcome!  Fetching your information.... ');
  //   FB.api('/me', function(response) {
  //     console.log('Successful login for: ' + response.name);
  //     document.getElementById('status').innerHTML =
  //       'Thanks for logging in, ' + response.name + '!';
  //   });
  // }

// checkLoginState()

function authFB(fb_user_id){
 $(function() {

  
  $('.sidenav').append('<div class="loading_white_wall"><div class="sk-cube-grid"><div class="sk-cube sk-cube1"></div><div class="sk-cube sk-cube2"></div><div class="sk-cube sk-cube3"></div><div class="sk-cube sk-cube4"></div><div class="sk-cube sk-cube5"></div><div class="sk-cube sk-cube6"></div><div class="sk-cube sk-cube7"></div><div class="sk-cube sk-cube8"></div><div class="sk-cube sk-cube9"></div></div></div>');


  })

FB.api('/me?fields=first_name,last_name,email,name,link', function(response) {

var fb_first_name = response.first_name;
var fb_last_name = response.last_name;
var fb_id = response.id;
var fb_email = response.email
var fb_username = response.name
var fb_link = response.link

// alert(response.name)
 
// alert(JSON.stringify(response.first_name))
 
// ajaxPost('/authfb/', {'username': fb_first_name , 'fb_id': fb_id}, function(){ 
$.ajax({
    url: '/authfb/',
    type:'POST',
    dataType: 'json',
    data: {"fb_first_name": fb_first_name, "fb_last_name": fb_last_name, "fb_username": fb_username, "fb_email":fb_email, "fb_id":fb_id, "fb_link":fb_link},
    success: function () {
      
      // alert('succes');
      setTimeout(
  function() 
  {
    $('#hide_group').hide();
    $('#show_group').show();
    $('.loading_white_wall').fadeOut();
    $('.greeting_title_name').html(fb_first_name);
    if(fb_email){
     
      $(".email_input").prop("value", fb_email);
    }

    else{

        $(".email_input").prop("placeholder", 'E-mail');
    }


  }, 1000);
      
    },
    error : function(data) {
      
      $('#hide_group').hide();
      $('#error_group').show();
      $('.loading_white_wall').fadeOut();

    }


  })

// });

                                  });


                 }






VK.init({
  apiId: 5932984
});
// function authInfo(response) {
//   if (response.session) {
//     alert('user: '+response.session.mid);
//   } else {
//     alert('not auth');
//   }
// }
// VK.Auth.getLoginStatus(authInfo);
// VK.UI.button('login_button');


function VKcheckLoginState(){

VK.Auth.getLoginStatus(function(response) {
  if (response.session) {
    alert('Авторизованный в Open API пользователь');
    // alert(JSON.stringify(response));
  } else {
   alert('Неавторизованный в Open API пользователь. Вызываем функцию залогиниться');
   VKlogin()

  }
});


}



function VKlogin(){


  VK.Auth.login(function(response) {
  if (response.session) {
    /* Пользователь успешно авторизовался */
    if (response.settings) {
      /* Выбранные настройки доступа пользователя, если они были запрошены */
    }
  } else {
    /* Пользователь нажал кнопку Отмена в окне авторизации */
  }
});

}
</script>







{% if request.user.is_authenticated %}



  <div class="logo_and_navigation">
   <div class="a_header_line">
    <div class="logo"><img src="{% static 'images/tick-tock.png' %}" /></div>
    <div class="navigation">
      <a href="/catologue/" class="navigation_link">Події</a>
      <a href="" class="navigation_link">FAQ</a>
      <a href="" class="navigation_link">Про проект</a>
      <a href="" class="navigation_profile_link"><img id='profilepicture' style="width: 30px;height: 30px;border-radius:50%;border: solid 1px #ffffff;background-color: gray;display: inline-block; text-align: center;" align="left" /><div class="navigation_profile_username">{{ request.user.userprofile.first_name}} {{ request.user.userprofile.last_name}} </div></a>
      <div class="a_sell_button"><a href="/sell/" style="line-height: 40px;color: #145cfb;">Продати квиток</a></div>
    </div>
    </div>  



{% else %} 

	<div class="logo_and_navigation">
   <div class="a_header_line">
		<div class="logo"><img src="{% static 'images/tick-tock.png' %}" /></div>
		<div class="navigation">
			<a href="/catologue/" class="navigation_link">Події</a>
			<a href="" class="navigation_link">FAQ</a>
			<a href="" class="navigation_link">Про проект</a>
			<div class="login_button"><span style="line-height: 40px;color: #145cfb;" onclick="openNav()">Войти</span></div>
			<div class="sell_button"><a href="/sell/" style="line-height: 40px;color: white">Продати квиток</a></div>
		</div>	
 </div>
 {% endif %}   
		

	</div>

      <div class="middle">
        <div class="middle_left">
         <div class="definition">Платформа для покупки та продажу білетів з рук</div>
        
	         <form class="search_form">

	              <div class="make_elegant_form">
          	         	 <input type="text" placeholder="введіть назву події.." ></input>
               
                    	         	 
                    	         	 <div type='button' class="city_select">


                                 <img class='location_img' src="{% static 'images/location.png' %}"/>
                                 <div style="line-height: 48px;display: inline-block;margin-left: 7px;">Київ</div>



                                </div>
          	         
          	         	     

                  
	         	   
                </div>
                      <input type="button" value="Знайти"  сlass="search_button"></input>
	         </form>
      
        

        </div>


        <div class="middle_right">
        	<img src="{% static 'images/sergio-alejandro-ortiz-110188@3x.png' %}" width="235px" height="135px" /> <img src="{% static 'images/concert.png' %}"/ width="235px" height="135px"> <img src="{% static 'images/part3x.png' %}" width="28px" height="135px" /> <br/>
        		<img style="margin-left: -60px;" src="{% static 'images/chuvak.png' %}" width="235px" height="135px" />	<img src="{% static 'images/green.png' %}" width="240" height="135px" />	<img src="{% static 'images/martins-zemlickis-57243@3x.png' %}" width="83px" height="135px" /><br/>
        			<img src="{% static 'images/stadion.png' %}" width="235" height="135px" />	<img src="{% static 'images/karina-carvalho-134501@3x.png' %}" width="240px" height="135px"/>


        </div>

      </div>

      <div class="events_parsing">
              <div class="events_title_and_all_events_link">
                    <div class="popular_events_title">Популярные события в
                         <span style="font-family: muse_bold">Киеве</span>
                    </div>

                    <div class="all_events_link">
                        Всі події
                    </div>
              </div>

		<!-- 	 {% for el in parsing %}
			<div style="width: 210px;display: inline-block;margin-left: 30px;margin-top: 20px;border: solid 1px #f8f9fb;box-shadow: 0 0 3px 0 rgba(6,7,14,0.12);">
				 <div style="height: 151px; background: url('{{ el.image }}') no-repeat; background-size: cover;/*filter: contrast(1.35);*/"></div>
				 <div style="height: 129px;margin-left: 12px;">
              <span class="event_date">12 НОЯБРЯ, СУББОТА 21:00</span>
              <span class="event_title">Симон Петлюра <br> "Легенда о Тиме"</span>
              <span class="event_place">Музкомедия им.Котика</span><br/>

              <span class="event_hashtag">#музика</span>

         </div>
			</div>
			
			
			{% endfor %} -->

      {% for event in events %}
      <a href="/event/{{ event.id}}">
      <div style="width: 216px;display: inline-block;margin-left: 30px;border: solid 1px #f8f9fb;box-shadow: 0 0 3px 0 rgba(6,7,14,0.12);;">
         <div style="height: 200px; background: url('{{ event.image_link }}') no-repeat; background-size: cover;/*filter: contrast(1.35);*/"></div>
         <div style="height: 109px;margin-left: 12px;">
              <span class="event_date"> {{ event.date}}</span>
              <span class="event_title">{{ event.title }}</span>
              <span class="event_place">{{ event.city}}, {{ event.place }}</span>

            <!--   <span class="event_hashtag">#</span> -->

         </div>
      </div>
      
    </a>
      {% endfor %}
      </div>

      <div class="mission">
      	<div class="mission_text_one">Наша місія - зробити пошук, покупку чи продаж <br/> білетів з рук оптимальнішим та безпечнішим.</div>
        <div class="mission_text_two">Ми побудували майданчик, де ви зможете знайти покупця чи продавця <br/> білету, також наша мета зробити процес покупки-продажу квитків з <br/> рук безпечнішим, та зменшити ймовірність шахрайства</div>
        <div class="mission_points">
        	<div class="mission_point">
        		<img src='{% static 'images/group-2.png' %}'/>
        		<div style="opacity: 0.6;margin-top: 14px">Каталог <br/> квитків</div>
        	</div>
        	<div class="mission_point">
        		<img src='{% static 'images/visa-card.png' %}'/>
        		<div style="opacity: 0.6;margin-top: 14px">Оплата <br/> карткою</div>
        	</div>
        	<div class="mission_point">
        			<img src='{% static 'images/envelope.png' %}'/>
        		<div style="opacity: 0.6;margin-top: 14px">Гарантоване <br/> отримання квитка</div>
        	</div>
        	<div class="mission_point">
        			<img src='{% static 'images/wallets.png' %}'/>
        		<div style="opacity: 0.6;margin-top: 14px">Гарантоване <br/> отримання коштів</div>
        	</div>
        	<div class="mission_point">
        			<img src='{% static 'images/emoticon-h.png' %}'/>
        		<div style="opacity: 0.6;margin-top: 14px">Модерація <br/> шахрайств</div>
        	</div>

        </div>

      </div>


      <div class="blue_screen">
       	<div class="blue_how_it_works_text">Як це працює</div>
       	<div class="blue_sell_or_buy">
       		<div class="blue_buy"><div style="line-height: 50px;font-family: 500;color: #145cfb;font-size: 20px;">покупка</div></div>
       		<div class="blue_sell"><div style="line-height: 50px;font-family: 500;font-size: 20px;color:black;opacity: 0.3">продажа</div></div>
       	</div>
       	<div class="blue_points">
       	   <div class="blue_point">
       	   	 <div class="blue_point_img"><img src='{% static 'images/lolipop.png' %}'/></div>
       	   	 <div class="blue_point_title">Знайдіть подію</div>
       	   	 <div class="blue_point_text">Знайдіть потрібну подію, <br/> скориставшись пошуком чи <br/> каталогом</div>
       	   </div>
       	      <div class="blue_point">
	       	     <div class="blue_point_img"><img src='{% static 'images/group-5.png' %}'/></div>
	       	   	 <div class="blue_point_title">Оберіть продавця зі списку</div>
	       	   	 <div class="blue_point_text">Оберіть людину, яка продає <br/> квиток та домовтесь<br/> про покупку</div>
       	      </div>


       	         <div class="blue_point">
	       	         <div class="blue_point_img"><img src='{% static 'images/blue/visa-card.png' %}'/></div>
		       	   	 <div class="blue_point_title">Сплатіть та отримайте квиток</div>
		       	   	 <div class="blue_point_text">Знайдіть потрібну подію, <br/> скориставшись пошуком чи <br/> каталогом</div>
       	         </div>
       		
       	</div>
      </div>

     <div class="grey_screen">

     		<div class="grey_activity_text">Активнисть <br/> сервісу <br/><span class="grey_activity_text_24"> за 24 години</span></div>

     		<div class="grey_right_top">
     			<div class="grey_right_top_element">25 <br><span class="grey_right_top_element_span">білетів додано</span></div>
     			<div class="grey_right_top_element">48 <br><span class="grey_right_top_element_span">білетів куплено</span></div>
     			<div class="grey_right_top_element">$666 <br><span class="grey_right_top_element_span">середня ціна</span></div>



     		</div>

     		<div class="grey_right_bottom">
     			Потап і Настя "Золоті Купола"<br/>
     			<span class="grey_right_bottom_span">найпопулярніша подія</span>
     		</div>

     </div>


    <div class="final_act" style="">
    	<div class='final_act_middle_left' style="">
	    	<div class="final_act_text">Продавайте чи купуйте квитки <br> з рук без зайвих зусиль</div><br>
	    	<span class="final_act_span">Забудьте про переживання під час покупки чи продажі <br> квитка, приєднуйтесь і ми все зробимо за вас</span>
	    	<div style="position: relative;display: block;margin-top: 6.4%;">
		        <div class="final_act_buy_button"><span style="line-height: 48px;">Купити Квиток</span></div>
		        <div class="final_act_sell_button"><span  style="line-height: 48px;">Продати Квиток</span></div>
	        </div>

	    </div>



        <div class="final_act_middle_right">
        	<img src="{% static 'images/sergio-alejandro-ortiz-110188@3x.png' %}" width="235px" height="135px" />
        	 <img src="{% static 'images/concert.png' %}"/ width="235px" height="135px">
        	  <img src="{% static 'images/part3x.png' %}" width="28px" height="135px" /> <br/>
        		<img style="margin-left: -60px;" src="{% static 'images/chuvak.png' %}" width="235px" height="135px" />	
        		<img src="{% static 'images/green.png' %}" width="240" height="135px" />
        			<img src="{% static 'images/martins-zemlickis-57243@3x.png' %}" width="83px" height="135px" /><br/>
        			<img src="{% static 'images/stadion.png' %}" width="235" height="135px" />
        				<img src="{% static 'images/karina-carvalho-134501@3x.png' %}" width="240px" height="135px"/>


        </div>
    </div>




      <div class="footer">
      			<div class='footer_left'>
              	    <div class="footer_title">Ваша найулюблиніша платформа для продажу та купівлі квитків</div><br>
              	    <span class="footer_span">Забудьте про переживання під час покупки чи продажі <br> квитка, приєднуйтесь і ми все зробимо за вас</span>

                    <div class="footer_navigation"><span class="footer_navigation_element"></span></div>
	            </div>



      </div>



<div id="mySidenav" class="sidenav">
  <div style="position: relative;margin-left: 8.1%;">
     <a href="javascript:void(0)" onclick="closeNav()"><img src="{% static 'images/group.svg' %}" align='left' style="margin-right: 10px;display: inline-block;"><div class="sidenav_close">Закрити</div></a>
     <div id="hide_group">
       <span class="sidenav_title">Ввійдить через одну з <br> соціальних мереж</span>
       <span class="sidenav_text">Залогінившись за допомогою соціальної<br>мережі, ви використовуваєте власний <br>профіль як гарант вашої порядочності</span>

      <div class="fb-login-button-custom" onClick="checkLoginState();" style="background: url({% static 'images/f-b.png' %});width: 400px;height: 56px;background-color: #3a5998;position:relative;display:block;margin-top: 7.6%;"></div>
       <!-- <div class="fb-login-button" data-size="large" data-show-faces="false" data-auto-logout-link="false" onlogin="checkLoginState();"></div> -->
        <div class="vk-login-button-custom" onClick="VKcheckLoginState();" style="background: url({% static 'images/v-k.png' %});width: 400px;height: 56px;margin-top: 1.2%;"></div>
        <span class="sidenav_prohibited_test"><img src="{% static 'images/prohibited.svg' %}" style="margin-right: 8px;"  align="left" />Ми нічого не будемо публікувати на вашії сторінці</span>
      </div>
      <div id="show_group" style="display: none;">
            <div class="greeting_title"><span class="greeting_title_name"></span>, Привіт!</div>
            <div class="greeting_text">Для того щоб закінчити реєстрацію, вам необхідно додати вашу електронну пошту та номер телефону</div>
            <br/>
            <form class="phone_mail_form">
                
                <input type="text"  class="phone_input" placeholder="Номер телефону" ></input>
                <span class="span_after_phone_input"></span><br/>
                 <input type="text" class="email_input" ></input><br/>
                   <span class="span_after_email_input"></span>
                 <div onclick="sendForm()" class="phone_mail_form_button_div"><span class="phone_mail_form_button_span">Продовжити</span></div>
            </form>
      </div>
        <div id="error_group" style="display: none;">
          <span class="error_666">Помилка #666</span>
          <span class="error_666_explain">Виникла помилка при продовженні роботи за допомогою з однієї соціальних мереж</span>
          <span class="error_666_try_again">Спробуйте ще раз або використайте профіль в іншній соціальнії мережі</span>
           <div onclick="tryLoginAgain()" class="phone_mail_form_button_div"><span class="phone_mail_form_button_span">Повторити спробу</span>

        </div>
  </div>
</div>


<script type='text/javascript'>


var sendForm;
var tryLoginAgain;


// > beginning of jquery 


 $(function() {


tryLoginAgain = function() {
      $('#error_group').hide()
      $('#hide_group').fadeIn()
}  

  
sendForm = function(){

 if($('.phone_input').val() === ""){

         
        $('.phone_input').removeClass('phone_input').addClass('phone_input_error');
        // $( "<span class='validation_error_text'>Електронна адресса обов'язкове полє</span>" ).insertAfter( ".phone_input" );

        $('.span_after_phone_input').html("<span class='validation_error_text'>Телефоний номер обов'язкове полє</span>")
}

 else if($('.email_input').val() === ""){

         
        $('.email_input').removeClass('email_input').addClass('email_input_error');
        // $( "<span class='validation_error_text'>Електронна адресса обов'язкове полє</span>" ).insertAfter( ".phone_input" );

        $('.span_after_email_input').html("<span class='validation_error_text'>Електронна адресса обов'язкове полє</span>")
}

else{

phone_number = $('.phone_input').val()
email = $('.email_input').val() 

  $.ajax({
    url: '/authsteptwo/',
    type:'POST',
    dataType: 'json',
    data: {"phone_number":phone_number, "email":email},
    success: function () {
      
      // alert('succes');
      setTimeout(
  function() 
  {
      alert('fine');
  }, 0);
      
    },
    error : function(data) {
      
    
        alert('fck');
    }


  })

   
}




}

  

  });

// < end of jquery 


// >function open-close side menu to logn

function openNav() {
    document.getElementById("mySidenav").style.width = "558px";
    document.getElementById("main").style.marginLeft = "250px";
}

function closeNav() {
    document.getElementById("mySidenav").style.width = "0";
    document.getElementById("main").style.marginLeft= "0";
}

// <function open-close side menu to logn
</script>

</body>
</html>